# GlassTrax Bridge - Docker Compose
# Documentation: https://codename-11.github.io/GlassTrax-Bridge/
#
# QUICK START:
#   1. Copy .env.example to .env and configure
#   2. docker-compose up -d
#
# The API runs inside the container and connects to a GlassTrax API Agent
# running on Windows for database access.

services:
  glasstrax-bridge:
    image: ghcr.io/codename-11/glasstrax-bridge:latest
    # Or build locally:
    # build:
    #   context: .
    #   dockerfile: docker/Dockerfile
    container_name: glasstrax-bridge
    ports:
      - "${PORT:-3000}:80"
    volumes:
      # Persist SQLite database AND config.yaml
      # Config is auto-created in data/ on first run
      - ./data:/app/data
    environment:
      # GlassTrax API Agent Configuration
      - GLASSTRAX_AGENT_ENABLED=${AGENT_ENABLED:-false}
      - GLASSTRAX_AGENT_URL=${AGENT_URL:-http://host.docker.internal:8001}
      - GLASSTRAX_AGENT_KEY=${AGENT_KEY:-}
      - GLASSTRAX_AGENT_TIMEOUT=${AGENT_TIMEOUT:-30}
      # Timezone
      - TZ=${TZ:-America/New_York}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/nginx-health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    restart: unless-stopped

# =============================================================================
# CONFIGURATION
# =============================================================================
#
# Option 1: Use .env file (recommended)
#   Copy .env.example to .env and edit values
#
# Option 2: Set environment variables inline
#   environment:
#     - GLASSTRAX_AGENT_ENABLED=true
#     - GLASSTRAX_AGENT_URL=http://192.168.1.100:8001
#     - GLASSTRAX_AGENT_KEY=gta_your_key_here
#
# =============================================================================
# FIRST RUN
# =============================================================================
#
# On first run, an admin API key is auto-generated and shown in the logs:
#   docker logs glasstrax-bridge
#
# Look for "INITIAL ADMIN API KEY GENERATED" - save this key!
#
# Default admin login:
#   Username: admin
#   Password: admin (CHANGE THIS via Settings page)
#
# Configuration:
#   Config file is stored at ./data/config.yaml (auto-created on first run)
#   Edit via Settings page in the Portal, or directly edit the file
#
# =============================================================================
# URLS
# =============================================================================
#
# Portal:    http://localhost:3000
# API:       http://localhost:3000/api/v1
# Swagger:   http://localhost:3000/api/docs
# Health:    http://localhost:3000/health
# Docs:      https://codename-11.github.io/GlassTrax-Bridge/
#
# =============================================================================
